<!DOCTYPE html>
<html>
<head><link rel="stylesheet" href="style.css"></head>
<body>
    <audio id="hit-sound" src="https://www.myinstants.com/media/sounds/punch.mp3"></audio>

    <div id="lobby" class="auth-container">
        <h1 style="color:var(--gold); font-size: 3rem;">ULTIMA 29</h1>
        <input type="text" id="user-name" placeholder="Enter Name">
        <div style="display: flex;">
            <button class="btn-gold" onclick="hostTable()">HOST TABLE</button>
            <button class="btn-gold" style="background:#333; color:white; margin-left:10px;" onclick="showJoin()">JOIN PRIVATE</button>
        </div>
        <div id="join-box" class="hidden" style="margin-top:20px;">
            <input type="text" id="join-code" placeholder="Enter 6-Digit Code">
            <button class="btn-gold" onclick="joinTable()">JOIN NOW</button>
        </div>
    </div>

    <div id="game" class="hidden">
        <div style="padding:15px; display:flex; justify-content:space-between;">
            <div>TABLE ID: <b id="display-id" style="color:var(--gold)">...</b></div>
            <div>WALLET: ‚Çπ<b id="wallet-amt">5000</b> (INR)</div>
        </div>

        <div class="casino-table" id="table-board">
            <div class="p-slot slot-0" id="p-0" onclick="showReactMenu(0)"><img src="https://cdn-icons-png.flaticon.com/512/149/149071.png" class="avatar"><br><small>You</small></div>
            <div class="p-slot slot-1" id="p-1" onclick="showReactMenu(1)"><img src="https://cdn-icons-png.flaticon.com/512/149/149071.png" class="avatar"><br><small>Pilot 1</small></div>
            <div class="p-slot slot-2" id="p-2" onclick="showReactMenu(2)"><img src="https://cdn-icons-png.flaticon.com/512/149/149071.png" class="avatar"><br><small>Pilot 2</small></div>
            <div class="p-slot slot-3" id="p-3" onclick="showReactMenu(3)"><img src="https://cdn-icons-png.flaticon.com/512/149/149071.png" class="avatar"><br><small>Pilot 3</small></div>
        </div>

        <div id="react-menu" class="hidden" style="position:fixed; bottom:120px; left:50%; transform:translateX(-50%); background:rgba(0,0,0,0.8); padding:15px; border-radius:20px;">
            <span style="font-size:30px; cursor:pointer;" onclick="fire('üëû')">üëû</span>
            <span style="font-size:30px; cursor:pointer; margin:0 15px;" onclick="fire('ü•ö')">ü•ö</span>
            <span style="font-size:30px; cursor:pointer;" onclick="fire('üí©')">üí©</span>
            <span style="font-size:30px; cursor:pointer; margin-left:15px;" onclick="fire('üçÜ')">üçÜ</span>
        </div>
        
        <button id="mic-btn" onclick="startMic()" style="position:fixed; bottom:20px; left:20px; border-radius:50%; width:60px; height:60px;">üé§</button>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        let curTable = "", targetIdx = null;

        function hostTable() {
            const name = document.getElementById('user-name').value;
            socket.emit('host-table', { username: name });
        }

        socket.on('table-created', code => {
            curTable = code;
            document.getElementById('display-id').innerText = code;
            document.getElementById('lobby').classList.add('hidden');
            document.getElementById('game').classList.remove('hidden');
        });

        // ‡¶â‡ßú‡ßá ‡¶Ø‡¶æ‡¶ì‡ßü‡¶æ ‡¶∞‡¶ø‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶∂‡¶® ‡¶≤‡¶ú‡¶ø‡¶ï
        function showReactMenu(idx) {
            targetIdx = idx;
            document.getElementById('react-menu').classList.toggle('hidden');
        }

        function fire(gift) {
            socket.emit('send-reaction', { tableID: curTable, gift, targetIdx });
            document.getElementById('react-menu').classList.add('hidden');
        }

        socket.on('fly-gift', ({ gift, targetIdx, fromId }) => {
            document.getElementById('hit-sound').play();
            const emoji = document.createElement('div');
            emoji.className = 'gift-item';
            emoji.innerText = gift;
            document.body.appendChild(emoji);

            const target = document.getElementById(`p-${targetIdx}`).getBoundingClientRect();
            emoji.style.left = '50%'; emoji.style.top = '80%'; // ‡¶®‡¶ø‡¶ö ‡¶•‡ßá‡¶ï‡ßá ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶π‡¶¨‡ßá

            setTimeout(() => {
                emoji.style.left = target.left + 'px';
                emoji.style.top = target.top + 'px';
            }, 50);

            setTimeout(() => emoji.remove(), 1000);
        });

        // ‡¶ì‡ßü‡¶æ‡¶≤‡ßá‡¶ü ‡¶∏‡¶ø‡¶ô‡ßç‡¶ï (Refresh Protection)
        window.onload = () => {
            const bal = localStorage.getItem('inr_bal') || 5000;
            document.getElementById('wallet-amt').innerText = bal;
        };
    </script>
</body>
</html>
