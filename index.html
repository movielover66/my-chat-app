<!DOCTYPE html>
<html>
<head><link rel="stylesheet" href="style.css"></head>
<body>
    <audio id="hit-sound" src="https://www.myinstants.com/media/sounds/punch.mp3"></audio>

    <div id="lobby" style="text-align:center; padding-top:100px;">
        <h1 style="color:var(--gold); font-size: 3rem;">ULTIMA 29</h1>
        <input type="text" id="p-name" placeholder="Name" style="padding:15px; width:80%; border-radius:10px;">
        <button onclick="host(false)" style="width:80%; padding:15px; background:var(--gold); margin-top:10px; border-radius:10px; font-weight:bold;">HOST PRIVATE</button>
        <button onclick="host(true)" style="width:80%; padding:15px; background:#22c55e; color:white; margin-top:10px; border-radius:10px; font-weight:bold;">PLAY WITH BOT</button>
    </div>

    <div id="game" class="hidden">
        <div style="padding:15px; display:flex; justify-content:space-between;">
            <div id="t-id" style="color:var(--gold)">ID: ...</div>
            <div>Wallet: â‚¹<b id="wallet-amt">5000</b> (INR)</div>
        </div>
        <div class="casino-table">
            <div class="p-slot slot-0" id="p-0" onclick="setT(0)"><img id="img-0" src="https://cdn-icons-png.flaticon.com/512/149/149071.png" class="avatar"><br><small>You</small></div>
            <div class="p-slot slot-1" id="p-1" onclick="setT(1)"><img id="img-1" src="https://cdn-icons-png.flaticon.com/512/149/149071.png" class="avatar"><br><small>Pilot 1</small></div>
            <div class="p-slot slot-2" id="p-2" onclick="setT(2)"><img id="img-2" src="https://cdn-icons-png.flaticon.com/512/149/149071.png" class="avatar"><br><small>Pilot 2</small></div>
            <div class="p-slot slot-3" id="p-3" onclick="setT(3)"><img id="img-3" src="https://cdn-icons-png.flaticon.com/512/149/149071.png" class="avatar"><br><small>Pilot 3</small></div>
        </div>
        <button id="mic-btn" onclick="toggleMic()" style="position:fixed; bottom:20px; left:20px; width:60px; height:60px; border-radius:50%; background:#444; color:white; border:none; font-size:24px;">ðŸŽ¤</button>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        let curCode = "", isMuted = true, targetIdx = null;

        function host(isBot) {
            const name = document.getElementById('p-name').value;
            socket.emit('host-table', { username: name, isBotMode: isBot });
            document.getElementById('lobby').classList.add('hidden');
            document.getElementById('game').classList.remove('hidden');
        }

        socket.on('table-created', code => {
            curCode = code; document.getElementById('t-id').innerText = "ID: "+code;
        });

        function toggleMic() {
            isMuted = !isMuted;
            document.getElementById('mic-btn').style.background = isMuted ? "#444" : "#ef4444";
            socket.emit('toggle-mic-stat', { tableID: curCode, isMuted: isMuted });
            // à¦ªà§à¦°à§‹à¦«à¦¾à¦‡à¦² à¦¸à¦¿à¦™à§à¦•
            document.getElementById('img-0').classList.toggle('mic-on', !isMuted);
        }

        function setT(idx) { targetIdx = idx; /* à¦°à¦¿à¦…à§à¦¯à¦¾à¦•à¦¶à¦¨ à¦®à§‡à¦¨à§ à¦“à¦ªà§‡à¦¨ à¦¹à¦¬à§‡ */ fire('ðŸ‘ž'); }

        function fire(gift) {
            socket.emit('send-reaction', { tableID: curCode, gift, targetIdx });
        }

        socket.on('fly-gift', ({ gift, targetIdx }) => {
            document.getElementById('hit-sound').play();
            const emoji = document.createElement('div');
            emoji.className = 'gift-item'; emoji.innerText = gift;
            document.body.appendChild(emoji);
            const target = document.getElementById(`p-${targetIdx}`).getBoundingClientRect();
            emoji.style.left = '50%'; emoji.style.top = '90%';
            setTimeout(() => { emoji.style.left = target.left+'px'; emoji.style.top = target.top+'px'; }, 50);
            setTimeout(() => emoji.remove(), 1000);
        });
    </script>
</body>
</html>
