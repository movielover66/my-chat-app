<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ultima 29 Pro Max - PRITAM</title>
    <script src="/socket.io/socket.io.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root { --gold: #ffcc00; --felt: #074a1d; --border: #3d2b1f; --inr: #22c55e; }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', sans-serif; }
        body { background: #020617; color: white; height: 100vh; overflow: hidden; display: flex; flex-direction: column; }
        .hidden { display: none !important; }
        
        /* Table Layout */
        .casino-floor { flex: 1; display: flex; align-items: center; justify-content: center; perspective: 1000px; }
        .table-29 { 
            width: 92vw; height: 60vh; max-width: 800px; background: radial-gradient(circle, var(--felt) 50%, #042410);
            border: 12px solid var(--border); border-radius: 180px; position: relative;
            box-shadow: 0 40px 80px rgba(0,0,0,0.8), inset 0 0 100px rgba(0,0,0,0.5);
            transform: rotateX(10deg);
        }

        .player-slot { position: absolute; width: 85px; text-align: center; }
        .pos-bottom { bottom: -60px; left: 50%; transform: translateX(-50%); }
        .pos-top { top: -60px; left: 50%; transform: translateX(-50%); }
        .pos-left { left: -75px; top: 50%; transform: translateY(-50%); }
        .pos-right { right: -75px; top: 50%; transform: translateY(-50%); }
        
        .pfp-img { width: 60px; height: 60px; border-radius: 15px; border: 3px solid var(--gold); background: #111; object-fit: cover; }
        .p-name { font-size: 11px; font-weight: bold; color: var(--gold); margin-top: 5px; background: rgba(0,0,0,0.7); padding: 2px 5px; border-radius: 5px; }

        /* Card Mechanics */
        .card-29 { width: 55px; height: 80px; background: white; border-radius: 8px; color: black; display: flex; flex-direction: column; align-items: center; justify-content: center; font-weight: 900; position: absolute; cursor: pointer; transition: 0.2s; box-shadow: 0 5px 10px rgba(0,0,0,0.3); }
        .card-29:hover { transform: translateY(-20px); z-index: 100; border: 2px solid var(--gold); }
        .suit-red { color: #e11d48; }
    </style>
</head>
<body>
    <div id="lobby-view" style="height:100vh; display:flex; flex-direction:column; align-items:center; justify-content:center; background: radial-gradient(circle, #1e1b4b, #020617);">
        <h1 style="color: var(--gold); font-size: 3.5rem; margin-bottom: 20px;">ULTIMA 29</h1>
        <div style="background: rgba(30, 41, 59, 0.9); padding: 40px; border-radius: 25px; width: 90%; max-width: 380px; text-align: center;">
            <input type="text" id="user-name-in" placeholder="Enter Pilot Name" style="width:100%; padding:15px; border-radius:12px; border:none; margin-bottom:20px; background:#111; color:white; border:1px solid #334155;">
            <button onclick="launchGame()" style="width:100%; padding:18px; background:var(--gold); border:none; border-radius:12px; font-weight:900; cursor:pointer; font-size: 1.1rem;">PLAY NOW (INR)</button>
            <p style="margin-top:20px; font-size:12px; opacity:0.6; font-weight: bold;">DEVELOPED BY PRITAM</p>
        </div>
    </div>

    <div id="game-view" class="hidden" style="flex:1; display:flex; flex-direction:column;">
        <div style="padding:15px; background:#000; border-bottom:1px solid var(--gold); display:flex; justify-content:space-between;">
            <div style="color:var(--gold); font-weight:900;">WALLET: ₹<span id="inr-wallet">5000</span></div>
            <div id="spec-info" style="font-size: 11px; opacity: 0.7;">Spectators: 0</div>
        </div>
        <div class="casino-floor">
            <div class="table-29">
                <div class="player-slot pos-bottom"><img src="https://cdn-icons-png.flaticon.com/512/149/149071.png" class="pfp-img"><div class="p-name" id="name-0">You</div></div>
                <div class="player-slot pos-left"><img src="https://cdn-icons-png.flaticon.com/512/149/149071.png" class="pfp-img"><div class="p-name" id="name-1">BOT 1</div></div>
                <div class="player-slot pos-top"><img src="https://cdn-icons-png.flaticon.com/512/149/149071.png" class="pfp-img"><div class="p-name" id="name-2">BOT 2</div></div>
                <div class="player-slot pos-right"><img src="https://cdn-icons-png.flaticon.com/512/149/149071.png" class="pfp-img"><div class="p-name" id="name-3">BOT 3</div></div>
                
                <div style="position:absolute; top:50%; left:50%; transform:translate(-50%, -50%); text-align:center;">
                    <div style="font-size:28px; color:var(--gold); font-weight:900;">₹<span id="pot-inr">0</span></div>
                    <span style="font-size:10px; opacity:0.5; font-weight:bold;">TOTAL POT (INR)</span>
                </div>

                <div id="my-hand" style="position:absolute; bottom:20px; left:50%; transform:translateX(-50%); width:320px; height:80px; display:flex; justify-content:center;"></div>
            </div>
        </div>
        
        <div style="height:100px; background:#000; display:flex; align-items:center; justify-content:center; gap:15px; border-top:1px solid #333;">
            <button onclick="placeBet(100)" style="background:#e91e63; padding:12px 20px; border-radius:30px; border:none; font-weight:bold; color:white; cursor:pointer;">₹100</button>
            <button onclick="placeBet(500)" style="background:#2196f3; padding:12px 20px; border-radius:30px; border:none; font-weight:bold; color:white; cursor:pointer;">₹500</button>
            <button onclick="placeBet(5000)" style="background:var(--gold); padding:12px 20px; border-radius:30px; border:none; font-weight:bold; color:black; cursor:pointer;">₹5K</button>
        </div>
    </div>
<script>
    const socket = io();
    let wallet = 5000;
    let roomID = "ROCKET-01";

    function launchGame() {
        const input = document.getElementById('user-name-in').value.trim();
        if(!input) return alert("Identify yourself, Pilot!");
        
        document.getElementById('lobby-view').classList.add('hidden');
        const gView = document.getElementById('game-view');
        gView.classList.remove('hidden');
        gView.style.display = 'flex';

        socket.emit('join-table', { 
            tableID: roomID, 
            username: input, 
            role: 'player', 
            coins: wallet 
        });
    }

    function placeBet(amt) {
        if(wallet < amt) return alert("Insufficient INR balance!");
        wallet -= amt;
        document.getElementById('inr-wallet').innerText = wallet;
        socket.emit('place-bet', { tableID: roomID, amount: amt });
    }

    socket.on('table-update', (data) => {
        document.getElementById('spec-info').innerText = `Spectators: ${data.spectators.length}`;
        data.players.forEach((p, i) => {
            const label = document.getElementById(`name-${i}`);
            if(label) label.innerText = p.username;
        });
    });

    // কার্ড খেলার লজিক (Error Fix)
    socket.on('deal-cards', (cards) => {
        const hand = document.getElementById('my-hand');
        hand.innerHTML = '';
        cards.forEach((c, i) => {
            const div = document.createElement('div');
            const isRed = c.suit === '♥' || c.suit === '♦';
            div.className = `card-29 ${isRed ? 'suit-red' : ''}`;
            div.style.left = `${i * 35}px`;
            div.innerHTML = `<span>${c.rank}</span><span>${c.suit}</span>`;
            div.onclick = () => {
                socket.emit('play-card', { roomID, card: c });
                div.remove(); // কার্ডটি হাত থেকে সরিয়ে দেওয়া
            };
            hand.appendChild(div);
        });
    });

    socket.on('bet-updated', (pot) => {
        document.getElementById('pot-inr').innerText = pot;
    });

    window.onbeforeunload = () => "Game data will be lost!";
</script>
</body>
</html>



